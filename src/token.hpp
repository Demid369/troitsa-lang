/**
 * @file: token.hpp
 * @description: Токены языка "Троица"
 * @dependencies: -
 * @created: 2026-02-02
 */

#ifndef T9_TROITSA_TOKEN_HPP
#define T9_TROITSA_TOKEN_HPP

#include <string>
#include <variant>
#include <cstdint>

namespace Троица {

/**
 * @brief Тип токена
 */
enum class ТипТокена {
    // === Конец файла ===
    КонецФайла,
    
    // === Литералы ===
    ЧислоЦелое,         // 42, -13, +7
    ЧислоВещественное,  // 3.14, 0.5, -2.718
    ЧислоТроичное,      // 0т1T0, 0т+−0 (троичный литерал)
    Строка,             // "привет"
    Символ,             // 'а'
    
    // === Идентификаторы ===
    Идентификатор,      // имяПеременной, функция1
    
    // === Ключевые слова ===
    КлючФункция,        // функция
    КлючТип,            // тип
    КлючПусть,          // пусть
    КлючИзменяемый,     // изм
    КлючВернуть,        // вернуть
    КлючЕсли,           // если
    КлючИначе,          // иначе
    КлючВыбор,          // выбор
    КлючСопоставить,    // сопоставить
    КлючЦикл,           // цикл
    КлючПока,           // пока
    КлючДля,            // для
    КлючВ,              // в
    КлючПрервать,       // прервать
    КлючПродолжить,     // продолжить
    КлючЭффект,         // эффект
    КлючС,              // с (для эффектов)
    КлючОбработать,     // обработать
    КлючЗадача,         // задача
    КлючПод,            // под (supervision)
    КлючМакрос,         // макрос
    КлючЦитата,         // цитата
    КлючВладеть,        // владеть
    КлючЛинейный,       // линейный
    
    // === Классы и модули ===
    КлючКласс,          // класс
    КлючНовый,          // новый
    КлючЭтот,           // этот (this)
    КлючРодитель,       // родитель (super)
    КлючНаследует,      // наследует (extends)
    КлючИмпорт,         // импорт
    КлючЭкспорт,        // экспорт
    КлючИз,             // из
    КлючКак,            // как (alias)
    КлючСтатический,    // статический
    КлючЧастный,        // частный (private)
    КлючОбщий,          // общий (public)
    
    // === Троичные литералы ===
    КлючДа,             // Да (+1)
    КлючНет,            // Нет (-1)
    КлючМожет,          // Может (0)
    КлючЕсть,           // Есть (для Возможно)
    КлючНеизвестно,     // Неизвестно
    
    // === Типы ===
    КлючТрит,           // Трит
    КлючТрайт,          // Трайт
    КлючГармония,       // Гармония
    КлючСтрока,         // Строка
    КлючЛогика,         // Логика
    КлючВозможно,       // Возможно
    КлючСписок,         // Список
    КлючСловарь,        // Словарь
    КлючРезультат,      // Результат
    
    // === Операторы арифметические ===
    ОпПлюс,             // +
    ОпМинус,            // -
    ОпУмножить,         // *
    ОпДелить,           // /
    ОпОстаток,          // %
    
    // === Операторы сравнения ===
    ОпРавно,            // ==
    ОпНеРавно,          // !=
    ОпМеньше,           // <
    ОпБольше,           // >
    ОпМеньшеРавно,      // <=
    ОпБольшеРавно,      // >=
    
    // === Операторы логические (троичные) ===
    ОпИ,                // И, &&
    ОпИли,              // ИЛИ, ||
    ОпНе,               // НЕ, !
    ОпКонсенсус,        // КОНСЕНСУС, &&&
    
    // === Операторы присваивания ===
    ОпПрисвоить,        // =
    ОпПлюсПрисвоить,    // +=
    ОпМинусПрисвоить,   // -=
    
    // === Разделители ===
    СкобкаКруглаяОткр,  // (
    СкобкаКруглаяЗакр,  // )
    СкобкаФигурнаяОткр, // {
    СкобкаФигурнаяЗакр, // }
    СкобкаКвадратнаяОткр, // [
    СкобкаКвадратнаяЗакр, // ]
    Запятая,            // ,
    Точка,              // .
    Двоеточие,          // :
    ТочкаЗапятая,       // ;
    Стрелка,            // ->
    ЖирнаяСтрелка,      // =>
    Вертикальная,       // |
    Амперсанд,          // &
    Диапазон,           // ..
    
    // === Специальные ===
    НоваяСтрока,        // \n (опционально для значимых переводов строк)
    Комментарий,        // // или /* */
    Ошибка              // Некорректный токен
};

/**
 * @brief Позиция в исходном коде
 */
struct Позиция {
    size_t строка;
    size_t столбец;
    size_t смещение;    // Байтовое смещение от начала
    
    Позиция() : строка(1), столбец(1), смещение(0) {}
    Позиция(size_t с, size_t ст, size_t см) : строка(с), столбец(ст), смещение(см) {}
    
    [[nodiscard]] std::string вСтроку() const {
        return std::to_string(строка) + ":" + std::to_string(столбец);
    }
};

/**
 * @brief Значение токена
 */
using ЗначениеТокена = std::variant<
    std::monostate,     // Нет значения
    int64_t,            // Целое число
    double,             // Дробное число
    std::string,        // Строка или идентификатор
    char32_t            // Символ Unicode
>;

/**
 * @brief Токен языка "Троица"
 */
struct Токен {
    ТипТокена тип;
    ЗначениеТокена значение;
    Позиция позиция;
    std::string текст;  // Исходный текст токена
    
    Токен() : тип(ТипТокена::Ошибка) {}
    
    Токен(ТипТокена т, Позиция п, std::string тк = "")
        : тип(т), позиция(п), текст(std::move(тк)) {}
    
    Токен(ТипТокена т, ЗначениеТокена з, Позиция п, std::string тк = "")
        : тип(т), значение(std::move(з)), позиция(п), текст(std::move(тк)) {}
    
    [[nodiscard]] bool это(ТипТокена т) const noexcept { return тип == т; }
    [[nodiscard]] bool конецФайла() const noexcept { return тип == ТипТокена::КонецФайла; }
    [[nodiscard]] bool ошибка() const noexcept { return тип == ТипТокена::Ошибка; }
    
    // Получение значений
    [[nodiscard]] int64_t какЦелое() const { return std::get<int64_t>(значение); }
    [[nodiscard]] double какВещественное() const { return std::get<double>(значение); }
    [[nodiscard]] const std::string& какСтрока() const { return std::get<std::string>(значение); }
    [[nodiscard]] char32_t какСимвол() const { return std::get<char32_t>(значение); }
};

/**
 * @brief Получить строковое представление типа токена
 */
[[nodiscard]] std::string имяТипаТокена(ТипТокена тип);

/**
 * @brief Проверить, является ли тип ключевым словом
 */
[[nodiscard]] bool этоКлючевоеСлово(ТипТокена тип) noexcept;

/**
 * @brief Проверить, является ли тип оператором
 */
[[nodiscard]] bool этоОператор(ТипТокена тип) noexcept;

} // namespace Троица

#endif // T9_TROITSA_TOKEN_HPP
